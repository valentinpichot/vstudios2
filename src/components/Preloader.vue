<template>
  <div ref="preloader" class="preloader">
    <div ref="preloaderContainer" class="preloader__container">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        width="500"
        zoomAndPan="magnify"
        viewBox="0 0 375 374.999991"
        height="500"
        preserveAspectRatio="xMidYMid meet"
        version="1.0"
        id="valBGContainer"
      >
        <defs>
          <g />
        </defs>
        <path
          fill="rgba(61, 77, 148, 0.76)"
          d="M 183.074219 61.917969 C 215.992188 61.917969 247.566406 74.992188 270.84375 98.269531 C 294.121094 121.550781 307.199219 153.121094 307.199219 186.039062 L 307.199219 188.949219 C 307.199219 221.867188 294.121094 253.4375 270.84375 276.71875 C 247.566406 299.996094 215.992188 313.070312 183.074219 313.070312 C 114.523438 313.070312 58.949219 257.5 58.949219 188.949219 L 58.949219 186.039062 C 58.949219 117.488281 114.523438 61.917969 183.074219 61.917969 Z M 183.074219 61.917969 "
          fill-opacity="1"
          fill-rule="nonzero"
        />
        <defs>
          <linearGradient id="gradient" x1="0" y1="1" x2="0" y2="0">
            <stop
              class="linearRemplissage"
              offset="0.01"
              style="stop-color: white; stop-opacity: 1"
            />
            <stop offset="0" style="stop-color: rgba(61, 77, 148, 0.76); stop-opacity: 1" />
            <stop offset="1" style="stop-color: rgba(61, 77, 148, 0.76); stop-opacity: 1" />
          </linearGradient>
        </defs>
        <g id="valBG" fill="url(#gradient)" fill-opacity="1">
          <g transform="translate(115.542326, 244.516553)">
            <g>
              <path
                d="M 35.765625 19.25 C 33.285156 19.25 31.289062 18.789062 29.78125 17.875 C 28.269531 16.957031 27.023438 15.316406 26.046875 12.953125 L 10.1875 -26.703125 C 9.21875 -29.179688 8.382812 -31.3125 7.6875 -33.09375 C 6.988281 -34.875 6.421875 -36.597656 5.984375 -38.265625 C 5.554688 -39.941406 5.257812 -41.722656 5.09375 -43.609375 C 4.9375 -45.492188 4.859375 -47.734375 4.859375 -50.328125 L 4.859375 -93.046875 C 4.859375 -94.453125 5.046875 -95.640625 5.421875 -96.609375 C 5.796875 -97.578125 6.363281 -98.382812 7.125 -99.03125 L 28 -116.671875 C 28.539062 -117.109375 29.269531 -117.460938 30.1875 -117.734375 C 31.101562 -118.003906 32.097656 -118.140625 33.171875 -118.140625 L 58.90625 -118.140625 C 61.5 -118.140625 63.46875 -117.515625 64.8125 -116.265625 C 66.15625 -115.023438 66.828125 -113.164062 66.828125 -110.6875 L 66.828125 -66.03125 C 66.828125 -64.945312 66.9375 -63.921875 67.15625 -62.953125 C 67.375 -61.984375 67.644531 -60.957031 67.96875 -59.875 L 68.453125 -58.75 L 68.453125 -93.046875 C 68.453125 -94.453125 68.640625 -95.640625 69.015625 -96.609375 C 69.398438 -97.578125 69.96875 -98.382812 70.71875 -99.03125 L 91.59375 -116.671875 C 92.132812 -117.109375 92.863281 -117.460938 93.78125 -117.734375 C 94.695312 -118.003906 95.691406 -118.140625 96.765625 -118.140625 L 122.1875 -118.140625 C 124.875 -118.140625 126.785156 -117.546875 127.921875 -116.359375 C 129.054688 -115.171875 129.625 -113.28125 129.625 -110.6875 L 129.625 -67.96875 C 129.625 -65.375 129.539062 -63.132812 129.375 -61.25 C 129.21875 -59.363281 128.921875 -57.582031 128.484375 -55.90625 C 128.054688 -54.238281 127.488281 -52.515625 126.78125 -50.734375 C 126.082031 -48.953125 125.25 -46.820312 124.28125 -44.34375 L 108.421875 -4.6875 C 108.097656 -3.71875 107.664062 -2.851562 107.125 -2.09375 C 106.59375 -1.34375 106.054688 -0.753906 105.515625 -0.328125 L 84.640625 16.984375 C 83.773438 17.742188 82.773438 18.3125 81.640625 18.6875 C 80.503906 19.0625 79.238281 19.25 77.84375 19.25 Z M 98.71875 0 C 100.769531 0 102.46875 -0.375 103.8125 -1.125 C 105.15625 -1.882812 106.207031 -3.289062 106.96875 -5.34375 L 122.828125 -44.984375 C 123.796875 -47.359375 124.601562 -49.4375 125.25 -51.21875 C 125.894531 -53 126.429688 -54.695312 126.859375 -56.3125 C 127.296875 -57.9375 127.59375 -59.632812 127.75 -61.40625 C 127.914062 -63.1875 128 -65.375 128 -67.96875 L 128 -110.6875 C 128 -112.738281 127.539062 -114.222656 126.625 -115.140625 C 125.707031 -116.054688 124.226562 -116.515625 122.1875 -116.515625 L 96.765625 -116.515625 C 94.722656 -116.515625 93.242188 -116.054688 92.328125 -115.140625 C 91.410156 -114.222656 90.953125 -112.738281 90.953125 -110.6875 L 90.953125 -66.1875 C 90.953125 -65.101562 90.84375 -64.019531 90.625 -62.9375 C 90.40625 -61.863281 90.082031 -60.734375 89.65625 -59.546875 L 82.046875 -36.734375 C 81.722656 -35.648438 81.34375 -34.921875 80.90625 -34.546875 C 80.476562 -34.171875 79.832031 -33.984375 78.96875 -33.984375 L 77.1875 -33.984375 C 76.320312 -33.984375 75.675781 -34.171875 75.25 -34.546875 C 74.820312 -34.921875 74.445312 -35.648438 74.125 -36.734375 L 66.515625 -59.390625 C 66.078125 -60.578125 65.75 -61.707031 65.53125 -62.78125 C 65.320312 -63.863281 65.21875 -64.945312 65.21875 -66.03125 L 65.21875 -110.6875 C 65.21875 -112.738281 64.675781 -114.222656 63.59375 -115.140625 C 62.519531 -116.054688 60.957031 -116.515625 58.90625 -116.515625 L 33.171875 -116.515625 C 31.117188 -116.515625 29.632812 -116.054688 28.71875 -115.140625 C 27.800781 -114.222656 27.34375 -112.738281 27.34375 -110.6875 L 27.34375 -67.96875 C 27.34375 -65.375 27.421875 -63.1875 27.578125 -61.40625 C 27.742188 -59.632812 28.039062 -57.9375 28.46875 -56.3125 C 28.90625 -54.695312 29.445312 -53 30.09375 -51.21875 C 30.75 -49.4375 31.5625 -47.359375 32.53125 -44.984375 L 48.390625 -5.34375 C 49.140625 -3.289062 50.1875 -1.882812 51.53125 -1.125 C 52.882812 -0.375 54.585938 0 56.640625 0 Z M 45.640625 -101.953125 L 47.25 -101.953125 L 47.25 -67 C 47.25 -64.195312 47.460938 -61.523438 47.890625 -58.984375 C 48.328125 -56.453125 48.976562 -54.109375 49.84375 -51.953125 L 60.53125 -26.046875 C 61.601562 -23.242188 62.8125 -20.898438 64.15625 -19.015625 C 65.507812 -17.128906 67.695312 -16.1875 70.71875 -16.1875 L 84.953125 -16.1875 C 87.972656 -16.1875 90.15625 -17.128906 91.5 -19.015625 C 92.851562 -20.898438 94.070312 -23.242188 95.15625 -26.046875 L 105.828125 -51.953125 C 106.691406 -54.109375 107.335938 -56.453125 107.765625 -58.984375 C 108.203125 -61.523438 108.421875 -64.195312 108.421875 -67 L 108.421875 -101.953125 L 110.046875 -101.953125 L 110.046875 -67 C 110.046875 -63.976562 109.851562 -61.195312 109.46875 -58.65625 C 109.09375 -56.125 108.421875 -53.671875 107.453125 -51.296875 L 96.765625 -25.40625 C 95.472656 -22.28125 94.015625 -19.691406 92.390625 -17.640625 C 90.773438 -15.585938 88.296875 -14.5625 84.953125 -14.5625 L 70.71875 -14.5625 C 67.375 -14.5625 64.890625 -15.585938 63.265625 -17.640625 C 61.648438 -19.691406 60.195312 -22.28125 58.90625 -25.40625 L 48.21875 -51.296875 C 47.25 -53.671875 46.578125 -56.125 46.203125 -58.65625 C 45.828125 -61.195312 45.640625 -63.976562 45.640625 -67 Z M 45.640625 -101.953125 "
              />
            </g>
          </g>
        </g>
      </svg>
      <div class="loading-text">
        <p ref="percentageText">0%</p>
      </div>
    </div>
  </div>
</template>

<script lang="ts">
import { defineComponent, onMounted, ref, watch } from 'vue'
import { usePreloaderStore } from '../stores/preloader'
import gsap from 'gsap'

export default defineComponent({
  // eslint-disable-next-line vue/multi-word-component-names
  name: 'Preloader',
  setup() {
    const preloader = ref<HTMLElement | null>(null)
    const preloaderContainer = ref<HTMLElement | null>(null)
    const percentageText = ref<HTMLElement | null>(null)
    const valBG = ref<HTMLElement | null>(null)
    const valBGContainer = ref<HTMLElement | null>(null)
    const linearRemplissage = ref<SVGStopElement | null>(null)
    const preloaderStore = usePreloaderStore()
    const preloaderDuration = 4

    watch(
      () => preloaderStore.isLoading,
      (newIsLoading) => {
        if (newIsLoading === false) {
          gsap.to(preloader.value, {
            duration: 1,
            y: '-100%',
            ease: 'power2.inOut',
            delay: preloaderDuration,
            onComplete: () => {
              if (preloader.value) {
                preloader.value.style.display = 'none'
              }
            }
          })
        }
      }
    )

    onMounted(() => {
      valBG.value = document.getElementById('valBG')
      valBGContainer.value = document.getElementById('valBGContainer')
      linearRemplissage.value = document.querySelector('.linearRemplissage') as SVGStopElement
      if (preloaderContainer.value) {
        gsap.fromTo(
          preloaderContainer.value,
          {
            y: '100%'
          },
          {
            y: '0%',
            duration: 2.5,
            ease: 'elastic.inOut(2,1)'
          }
        )
      }
      if (linearRemplissage.value) {
        gsap.to(linearRemplissage.value, {
          attr: { offset: '1' },
          ease: 'power1.inOut',
          delay: preloaderDuration / 2,
          duration: preloaderDuration / 2
        })
      }
      if (percentageText.value) {
        gsap.to(percentageText.value, {
          innerHTML: 100,
          duration: preloaderDuration,
          ease: 'linear',
          snap: { innerHTML: 1 },
          onUpdate: function () {
            if (percentageText.value) {
              percentageText.value.innerHTML =
                Math.round(Number(gsap.getProperty(percentageText.value, 'innerHTML'))) + '%'
            }
          }
        })
      }
    })

    return {
      preloader,
      preloaderContainer,
      percentageText,
      valBG,
      valBGContainer,
      linearRemplissage
    }
  }
})
</script>
